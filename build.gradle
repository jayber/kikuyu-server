task mergeProjects << {
    println("starting...")
    File directory = createDirectory()

    copyFromDirToDir("c:/work/kikuyu-server", directory.absolutePath)
    copyFromDirToDir("c:/work/ergle-web-client", directory.absolutePath + "/erglewebclient")
    copyFromDirToDir("c:/work/ergle-api", directory.absolutePath + "/ergleapi")

    ant.concat(destfile: directory.absolutePath + "/build.sbt", append: true) {
        filelist(dir: directory.absolutePath, files: "buildConcat.txt")
    }
}

private void copyFromDirToDir(String sourceDir, String targetDir) {
    println("copying $sourceDir to $targetDir")
    ant.copy(toDir: targetDir) {
        fileset(dir: sourceDir) {
            exclude(name: "**/target/**")
            exclude(name: "./**")
        }
    }
}

private File createDirectory() {
    def tempDir = System.getProperty("java.io.tmpdir")
    def file = new File(tempDir, "kikuyuBuild")
    if (file.exists()) {
        ant.delete(dir: file.absolutePath)
    }
    file.mkdir()
    file
}